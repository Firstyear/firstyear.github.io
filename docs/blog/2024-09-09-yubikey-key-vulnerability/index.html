<!DOCTYPE html>
<html lang="en">
    <head>
        
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />

        <meta name="description" content="Firstyear&#x27;s blog">
        

        <title>Firstyear&#x27;s blog-a-log</title>

        
          <link rel="alternate" type="application/rss+xml" title="RSS" href="https://fy.blackhats.net.au/rss.xml">
        

        
            <link rel="stylesheet" href="https://fy.blackhats.net.au/theme.css">
        
        
    </head>
    <body>
        <div class="content">
        
        
            <header>
                <div class="header-left">
                    <a href="https:&#x2F;&#x2F;fy.blackhats.net.au" class="logo">Firstyear&#x27;s blog-a-log</a>
                </div>
                <div class="header-right">
                    <nav itemscope itemtype="http://schema.org/SiteNavigationElement">
                      <ul>
                        
                        
                            
                            <li class="nav">
                                <a itemprop="url" href="https://fy.blackhats.net.au/blog/">
                                    <span itemprop="name">Blog</span>
                                </a>
                            </li>
                        
                            
                            <li class="nav">
                                <a itemprop="url" href="https://fy.blackhats.net.au/pages/">
                                    <span itemprop="name">Pages</span>
                                </a>
                            </li>
                        
                        
                        <li class="nav">
                            <a itemprop="url" href="https://github.com/firstyear">
                                <img class="icon" src="https:&#x2F;&#x2F;fy.blackhats.net.au/icons/github.svg" alt="Github">
                            </a>
                        </li>
                        
                        <li class="nav">
                            <a itemprop="url" href="/rss.xml">
                                <img class="icon" src="https:&#x2F;&#x2F;fy.blackhats.net.au/rss-logo.png" alt="rss">
                            </a>
                        </li>
                      </ul>
                    </nav>
                </div>
            </header>
        
        
        <main>
            
<article itemscope itemtype="http://schema.org/BlogPosting">
    <div itemprop="headline">
        <h1>Yubikey Key Vulnerability - How It Affects You</h1>
        <div class="border"></div>
        <time datetime="2024-09-09" class="date" itemprop="datePublished">
            09 Sep 2024
        </time>
    </div>
    <div itemprop="articleBody">
        <p>On the 3rd of September, Yubico announced <a href="https://www.yubico.com/support/security-advisories/ysa-2024-03/">YSA-2024-03, a vulnerability in the infineon</a>
cryptograhpic library which may allow private key extraction to be performed. As is tradition, arm
chair experts and thought leaders everywhere rushed to have hot takes on the situation, without
adequately understanding the way that the attack works and how it fits into Webauthn on a technical
level.</p>
<h2 id="tl-dr-do-i-need-to-worry">TL;DR - Do I Need To Worry</h2>
<p>No. This attack while cool as heck, is not a risk to the majority of yubikey users.</p>
<blockquote>
<p>But I write opensource code, I'm a target of
NSA/ASIO/MI5/<a href="https://memory-alpha.fandom.com/wiki/Obsidian_Order">Obsidian Order</a> surveillence</p>
</blockquote>
<p>No you aren't, keep using your yubikeys.</p>
<h2 id="the-attack">The Attack</h2>
<p>Let's examine yubicos statement about the attack.</p>
<blockquote>
<p>An attacker could exploit this issue as part of a sophisticated and targeted attack to recover
affected private keys. The attacker would need physical possession of the YubiKey, Security Key,
or YubiHSM, knowledge of the accounts they want to target, and specialized equipment to perform
the necessary attack. Depending on the use case, the attacker may also require additional
knowledge including username, PIN, account password, or authentication key. See Affected Use
Cases and Mitigations for more details.</p>
</blockquote>
<p>Wow, that's pretty scary. Private keys can be recovered from our secure key hardware! The attacker
only needs possession! Think of the evil maid's getting excited to perform this attack right now!</p>
<p>This statement sadly on the part of Yubico is vague to the details of how the attack is carried out
and this affects people's ability to perform adequate risk assessment.</p>
<p>The details are buried in the <a href="https://ninjalab.io/eucleak/">eucleak</a> paper, but the attacker requires:</p>
<ul>
<li>The private key must be ECDSA (the default for Webauthn/FIDO2)</li>
<li>Physical access to the yubikey</li>
<li>Knowledge of the users PIN</li>
<li>The ability to <em>disassemble the key</em></li>
<li>Specialised equipment to recover the keys</li>
</ul>
<p>From this, there are four key defences that you still have:</p>
<ul>
<li>Your PIN</li>
</ul>
<p>Without knowing your PIN, the keys can not be recovered. The recovery can only be performed <em>during</em>
a signature operation using the key which requires your PIN for each operation.</p>
<p>The authors of the eucleak paper note this:</p>
<blockquote>
<p>When this is possible activate all defense layers, e.g. enforce the use of a PIN (or any
biometrics) to access to the device.</p>
</blockquote>
<p>Provided that the websites you have used your key with enforce user verification (aka a PIN) then the
key would be impossible te recover without this. Yubikeys natively have PIN bruteforce protections
to prevent and limit the ability of at attacker to attempt to steal your PIN, even with possession.</p>
<ul>
<li>The Attack Is Destructive</li>
</ul>
<p>To carry out the attack, the yubikey needs to be <em>taken apart</em> or <em>drilled open</em>. It's extremely
obvious when someone carries this out, and only a highly resourced, motivated, and skilled attacker
could consider repairing the key in such a way to mask the subterfuge.</p>
<ul>
<li>The Attack Requires Possession</li>
</ul>
<p>The attacker needs physical access to the key for approximately one hour to carry out the attack, and
that is excluding the possible time to repair the damaged key case post attack.</p>
<ul>
<li>The Attack Targets ECDSA Keys - Not the Master Key</li>
</ul>
<p>Every website that you enroll your yubikey to as a device has a <em>unique private key</em> associated to it.
While this attack can retrieve the private key, this only allows the attacker to recover one private
key at a time, which requires the key to be a resident key, or the attacker needs the CredentialID
associated to this yubikey to proceed. Each CredentialID is protected by a device master key and so
extraction of one private key only compromises the one target site - not every credential the key
has ever issued.</p>
<p>In addition of the attacker is targetting a website that may be behind a VPN, they may not be able
to capture the CredentialID in the place to allow the attack to proceed. In some cases the CredentialID
may be behind a pre-auth (such as a password auth) step which also prevents the attacker accessing
the CredentialID needed for the private key attack to begin at all.</p>
<h2 id="threat-model-consumer-device">Threat Model - Consumer Device</h2>
<p>So now knowing this what is the risk to the average consumer?</p>
<p>Given the need for your PIN, physical access, and the attack being destructive, it's unlikely that
anyone will carry out this attack without a high value target and reason.</p>
<p>Another way to frame this, is that there are very few persons in the world who would be worth the
expenditure in resources to conduct a targetted against in this manner. And if the attacker is
already in possession of the device <em>and</em> your PIN, in most cases the need to execute this attack
aren't required since the attacker can simply sign in to your account and then steal the session
cookies or whatever else.</p>
<p>Finally, the authors of the paper even state:</p>
<blockquote>
<p>Let us emphasize here that we strongly encourage to continue to use an EUCLEAK vulnerable product
rather than switching to a solution that does not involve a secure element.</p>
</blockquote>
<h2 id="side-quest-attestation">Side Quest - Attestation</h2>
<p>As a refresher, lets talk about what attestation is.</p>
<p>When you enroll a security key to a website, that website has no knowledge about your key. In fact
all that website sees (in simple versions) is a public key and some boolean flags describing
true/false if you touched the device during the signature, and if you entered a PIN or biometric
when you used the device.</p>
<p>Yes, that's right, when you enter your PIN to your security key, that stays local on the key and
all the remote website sees is a "promise, I actually did check the PIN, you can trust me".</p>
<p>This means someone could easily just make a software key that sends the user-presence and user-verification
flags, even if they didn't actually validate them or enforce presence or verification (looking at
you password managers).</p>
<p>In most cases though this isn't a problem - the use of cryptographic authentication for the user
is a significant improvement over the use of passwords and/or other factors. If a user chooses to
do a silly and make a fake-cereal-box key, that's on them to accept the finding out of their fucking
around.</p>
<p>But in other places, we can not afford to find out. There may be regulations or rules that enforce
policies that must be adhered to for a number of reasons.</p>
<p>For this reason we need a way to signal to the website not just that we have "a security key" but
that we have a precise make and model of key, that conforms to a set of guaranteed properties. To
achieve this, security keys support a process called attestation which provides a cryptographic
proof that the key is a specific make and model.</p>
<p>This allows a website to trust a certificate authority (such as the Yubico CA) and when the key
is enrolled it uses it's attestation key to <em>sign</em> the public key as we enroll our key to the website.
The website can then trace the trust chain back cryptographically to the Yubico CA and have a strong
proof that the key being enrolled <em>must</em> be a legitimate yubikey.</p>
<h2 id="threat-model-attestation">THreat Model - Attestation</h2>
<p>So now with our eucleak attack, this <em>does</em> have an impact on sites that enforce attestation. This
is because a yubikeys <em>attestation</em> key can now be extracted from a legitimate device that is in
the attackers possession. Using the extracted attestation key, we can now sign <em>any</em> key as though
it came from a real yubikey. Your password manager could cosplay cryptographically as a yubikey
for example.</p>
<p>This has implications on sites that do require strict attestation as it is now possible that someone
may attempt to enroll "I can't believe it's not a yubikey" to an account, bypassing the expected
security controls.</p>
<p>There are still limited use cases for this, but the primary would be enrolling an attacker controlled
exportable key to an account, while retaining the appearance of it being a legitimate yubikey.</p>
<blockquote>
<p>NOTE: This does not affect PIV/SmartCard attestation by default since smartcard attestation in yubikeys
uses an RSA attestation key instead of an ECDSA one. If you have enrolled your own attestation key
that uses ECDSA then this can be extracted, but again falls into the categories above regarding
the need for possession and destruction of the key.</p>
</blockquote>
<h2 id="conclusion">Conclusion</h2>
<p>While this attack is novel and super technically cool in a spy thriller move heist kind of way,
for most yubikey users there is minimal risk to your keys.</p>
<p>The risks that do exist are to organisations with high security assurance needs which rely on attestation,
as the trust in attestation provided by the device may now come into question in some circumstances.</p>

    </div>
</article>

        </main>
        
        <footer>
            
            <div class="border"></div>
            <div class="footer">
                <small class="footer-left">
                    Copyright &copy; William Brown
                </small>
                <small class="footer-right">
                    Powered by <a href="https://www.getzola.org">Zola</a> | Theme <a href="https://github.com/barlog-m/oceanic-zen">Oceanic Zen</a>
                </small>
            </div>
        
        </footer>
    
        </div>
    </body>
</html>
